<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CXR-Vision AI | Intelligent Radiograph Analysis</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <style>
        :root {
            --dark-bg-primary: #121212;
            --dark-bg-secondary: #1E1E1E;
            --text-primary: #FFFFFF;
            --text-secondary: #B3B3B3;
            --accent-primary: #0BA34E;
            --accent-hover: #087a3b;
            --border-color: #2e2e2e;
            --font-family: 'Poppins', sans-serif;
        }
        body { margin: 0; font-family: var(--font-family); background-color: var(--dark-bg-primary); color: var(--text-primary); scroll-behavior: smooth; }
        section { padding: 100px 8%; min-height: 100vh; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; }
        h2 { text-align: center; font-size: 2.5rem; margin-bottom: 60px; position: relative; }
        h2::after { content: ''; position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); width: 80px; height: 4px; background-color: var(--accent-primary); border-radius: 2px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(11, 163, 78, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(11, 163, 78, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(11, 163, 78, 0); } }
        .navbar { position: fixed; top: 0; left: 0; width: 100%; padding: 15px 8%; display: flex; justify-content: space-between; align-items: center; z-index: 1000; transition: background-color 0.3s ease; animation: fadeIn 1s ease-out; box-sizing: border-box; }
        .navbar.scrolled { background-color: rgba(30, 30, 30, 0.9); backdrop-filter: blur(10px); }
        .logo { font-size: 1.8rem; font-weight: 700; color: var(--text-primary); text-decoration: none; }
        .logo span { color: var(--accent-primary); }
        .nav-links { list-style: none; display: flex; gap: 30px; margin: 0; padding: 0; }
        .nav-links a { color: var(--text-secondary); text-decoration: none; font-weight: 600; transition: color 0.3s ease; }
        .nav-links a:hover { color: var(--accent-primary); }
        .hero { text-align: center; height: 100vh; background: linear-gradient(rgba(18, 18, 18, 0.7), rgba(18, 18, 18, 0.9)), url('https://images.unsplash.com/photo-1581092918458-2f193a0b5b1b?w=1080') no-repeat center center/cover; }
        .hero-title { font-size: 4rem; margin-bottom: 20px; }
        .hero-title .letter { display: inline-block; opacity: 0; transform: scale(1.5); animation: fadeIn 0.5s forwards; }
        .hero-tagline { font-size: 1.5rem; color: var(--text-secondary); margin-bottom: 40px; animation: fadeIn 1s 1s backwards; }
        .cta-button { padding: 15px 30px; font-size: 1.2rem; font-weight: 600; color: white; background-color: var(--accent-primary); border: none; border-radius: 50px; cursor: pointer; text-decoration: none; transition: all 0.3s ease; }
        .cta-button:disabled { background-color: #555; cursor: not-allowed; }
        .cta-button.pulse { animation: fadeIn 1s 1.5s backwards, pulse 2s infinite 2s; }
        .cta-button:hover:not(:disabled) { background-color: var(--accent-hover); animation-play-state: paused; }
        .upload-panel { display: flex; flex-direction: column; align-items: center; gap: 30px; }
        .drop-zone { width: 100%; max-width: 800px; padding: 60px 30px; border: 3px dashed var(--border-color); border-radius: 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .drop-zone.drag-over { border-color: var(--accent-primary); background-color: rgba(11, 163, 78, 0.1); }
        .drop-zone p { font-size: 1.2rem; color: var(--text-secondary); }
        
        /* New Analysis Dashboard Layout */
        .analysis-dashboard { display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; align-items: flex-start; width: 100%; margin-top: 50px; opacity: 0; animation: fadeIn 1s forwards; }
        .image-display-card, .results-card { background-color: var(--dark-bg-secondary); padding: 25px; border-radius: 15px; border: 1px solid var(--border-color); }
        .image-display-card img { width: 100%; border-radius: 8px; }

        /* 2. New Horizontal Bar Chart Styling */
        .h-chart-container { width: 100%; display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .h-chart-row { display: flex; align-items: center; width: 100%; }
        .h-chart-label { width: 30%; font-size: 0.9rem; color: var(--text-secondary); padding-right: 15px; text-align: right; }
        .h-chart-bar-bg { flex-grow: 1; height: 20px; background-color: var(--border-color); border-radius: 5px; }
        .h-chart-bar-fill { height: 100%; background-color: var(--accent-primary); border-radius: 5px; transform: scaleX(0); transform-origin: left; transition: transform 1s cubic-bezier(0.25, 1, 0.5, 1); display: flex; align-items: center; justify-content: flex-end; }
        .h-chart-value { color: white; font-size: 0.8rem; font-weight: 600; padding: 0 10px; opacity: 0; transition: opacity 0.5s 0.5s; }
        .h-chart-container.visible .h-chart-bar-fill { transform: scaleX(1); }
        .h-chart-container.visible .h-chart-value { opacity: 1; }
        
        .heatmap-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; width: 100%; margin-top: 50px; }
        .heatmap-card { background-color: var(--dark-bg-secondary); padding: 25px; border-radius: 15px; border: 1px solid var(--border-color); opacity: 0; animation: fadeIn 0.5s forwards; transition: transform 0.3s, box-shadow 0.3s; }
        .heatmap-card:hover { transform: translateY(-10px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .heatmap-card h4 { margin-top: 0; text-align: center; color: var(--accent-primary); }
        .heatmap-card img { width: 100%; border-radius: 8px; margin-bottom: 15px; }
        .footer { background-color: var(--dark-bg-secondary); padding: 60px 8%; text-align: center; min-height: auto; }
        hr.section-divider { margin: 60px 0; border: none; border-top: 2px solid var(--border-color); }
        @media (max-width: 992px) { .analysis-dashboard { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .nav-links { display: none; } section { padding: 80px 5%; } .hero-title { font-size: 2.5rem; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/javascript">
        const e = React.createElement;

        // --- Navbar Component (Updated Logo) ---
        const Navbar = () => {
            const [scrolled, setScrolled] = React.useState(false);
            React.useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);
            return e('nav', { className: `navbar ${scrolled ? 'scrolled' : ''}` },
                // 1. Logo text changed
                e('a', { href: '#hero', className: 'logo' }, 'CXR-Vision', e('span', null, 'AI')),
                e('ul', { className: 'nav-links' },
                    e('li', null, e('a', { href: '#upload' }, 'Analyzer')),
                    e('li', null, e('a', { href: '#footer' }, 'About'))
                )
            );
        };
        
        // --- Hero Component ---
        const Hero = () => {
            const title = "AI-Powered-X-Ray-Analysis";
            return e('section', { id: 'hero', className: 'hero' },
                e('h1', { className: 'hero-title' },
                    title.split("").map((letter, index) =>
                        e('span', { key: index, className: 'letter', style: { animationDelay: `${index * 0.05}s` } }, letter === " " ? "\\u00A0" : letter)
                    )
                ),
                e('p', { className: 'hero-tagline' }, 'Instant, Accurate, and Transparent Thoracic Pathology Detection.'),
                e('a', { href: '#upload', className: 'cta-button pulse' }, 'Upload X-Ray')
            );
        };

        // --- New Horizontal BarChart Component ---
        const HorizontalBarChart = ({ data }) => {
            const [isVisible, setIsVisible] = React.useState(false);
            React.useEffect(() => {
                const timer = setTimeout(() => setIsVisible(true), 100);
                return () => clearTimeout(timer);
            }, [data]);
            
            return e('div', { className: `h-chart-container ${isVisible ? 'visible' : ''}` },
                data.map((item, index) => 
                    e('div', { key: item.name, className: 'h-chart-row' },
                        e('div', { className: 'h-chart-label' }, item.name),
                        e('div', { className: 'h-chart-bar-bg' },
                            e('div', {
                                className: 'h-chart-bar-fill',
                                style: { 
                                    width: `${item.confidence}%`,
                                    transitionDelay: `${index * 0.05}s`
                                },
                                title: `${item.name}: ${item.confidence}%`
                            },
                               e('span', { className: 'h-chart-value'}, `${item.confidence}%`)
                            )
                        )
                    )
                )
            );
        };

        // --- Upload Component (Using new Chart) ---
        const Upload = () => {
            const [isAnalyzing, setIsAnalyzing] = React.useState(false);
            const [file, setFile] = React.useState(null);
            const [fileURL, setFileURL] = React.useState('');
            const [predictions, setPredictions] = React.useState([]);
            const [heatmaps, setHeatmaps] = React.useState([]);
            const [error, setError] = React.useState('');

            const onDrop = React.useCallback(acceptedFiles => {
                const currentFile = acceptedFiles[0];
                setFile(currentFile);
                setFileURL(URL.createObjectURL(currentFile));
                setPredictions([]);
                setHeatmaps([]);
                setError('');
            }, []);
            
            const handleAnalyze = async () => {
                if (!file) return;
                setIsAnalyzing(true);
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch('/analyze', { method: 'POST', body: formData });
                    if (!response.ok) throw new Error(`Server error: ${response.statusText}`);
                    const data = await response.json();
                    if (data.error) throw new Error(data.error);
                    setPredictions(data.predictions);
                    setHeatmaps(data.heatmaps || []);
                } catch (err) {
                    setError(`Analysis failed: ${err.message}`);
                } finally {
                    setIsAnalyzing(false);
                }
            };
            
            const { getRootProps, getInputProps, isDragActive } = useDropzone({ onDrop, accept: {'image/*': ['.png', '.jpeg', '.jpg']} });

            const topFindings = predictions.filter(p => p.confidence > 50);

            return e('section', { id: 'upload' },
                e('h2', null, 'AI Prediction Analyzer'),
                e('div', { className: 'upload-panel' },
                    e('div', { ...getRootProps(), className: `drop-zone ${isDragActive ? 'drag-over' : ''}` },
                        e('input', { ...getInputProps() }),
                        file ? e('p', null, `✅ File ready: ${file.name}`) : e('p', null, 'Drag & drop an X-ray image here, or click to select')
                    ),
                    e('button', { onClick: handleAnalyze, className: 'cta-button', disabled: isAnalyzing || !file },
                        isAnalyzing ? 'Analyzing...' : 'Analyze Image'
                    )
                ),
                error && e('p', { style: { color: 'red', textAlign: 'center', marginTop: '20px' } }, error),
                
                predictions.length > 0 && e('div', { className: 'analysis-dashboard' },
                    e('div', { className: 'image-display-card' },
                        e('h3', { style: { marginTop: 0 } }, 'Uploaded Image'),
                        e('img', { src: fileURL, alt: 'Uploaded X-Ray' })
                    ),
                    e('div', { className: 'results-card' },
                        e('h3', { style: { marginTop: 0 } }, 'Analysis Report'),
                        topFindings.length > 0 ?
                            e('p', null, 'The model has identified the following potential findings:') :
                            e('p', null, 'No significant pathologies detected above the 50% confidence threshold.'),
                        topFindings.map(finding => e('li', {key: finding.name}, `${finding.name}`)),
                        e(HorizontalBarChart, { data: predictions }) // Using the new Horizontal Bar Chart
                    )
                ),

                heatmaps.length > 0 && e('div', null,
                    e('hr', {className: 'section-divider'}),
                    e('h2', {style: {fontSize: '2rem'}}, 'Explainable AI (XAI) Visualizations'),
                    e('p', { style: { textAlign: 'center', color: 'var(--text-secondary)', marginTop: '-40px', marginBottom: '40px' } }, 'The highlighted areas show where the AI focused to make its predictions.'),
                    e('div', { className: 'heatmap-grid' },
                        heatmaps.map((heatmap, index) =>
                            e('div', { className: 'heatmap-card', key: index, style: { animationDelay: `${index * 0.15}s` } },
                                e('img', { src: `data:image/png;base64,${heatmap.image}` }),
                                e('h4', null, heatmap.disease)
                            )
                        )
                    )
                )
            );
        };

        // --- Footer Component ---
        const Footer = () => e('footer', { id: 'footer', className: 'footer' }, e('p', null, '© 2025 CXR-Vision AI. All Rights Reserved. For informational and educational purposes only.'));
        
        // --- Main App Component ---
        const App = () => e(React.Fragment, null, e(Navbar), e('main', null, e(Hero), e(Upload)), e(Footer));

        // --- Render the App ---
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        const useDropzone = ({ onDrop, accept }) => { // Simplified dropzone for transpiled env
            const onDragOver = e => e.preventDefault();
            const handleDrop = e => { e.preventDefault(); onDrop(Array.from(e.dataTransfer.files)); };
            const openFileDialog = () => {
                const input = document.createElement('input');
                input.type = 'file'; input.accept = Object.keys(accept).join(',');
                input.onchange = e => onDrop(Array.from(e.target.files));
                input.click();
            };
            const getRootProps = () => ({ onDragOver, onDrop, onClick: openFileDialog });
            const getInputProps = () => ({});
            return { getRootProps, getInputProps, isDragActive: false };
        };
        root.render(e(App));
    </script>
</body>
</html>